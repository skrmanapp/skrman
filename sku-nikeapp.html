<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>自助监控</title>
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/icon" href="assets/images/favicon.ico"/>
    <!-- Font Awesome -->
    <link href="assets/css/font-awesome.min.css" rel="stylesheet">

    <!-- Slick slider -->
    <link href="assets/css/slick.css" rel="stylesheet">
    <!-- Theme color -->
    <link id="switcher" href="assets/css/theme-color/default-theme.css" rel="stylesheet">


    <!-- Main Style -->
    <link href="skuStyle.css" rel="stylesheet">




    <!-- Bootstrap 本地版 -->
    <!--<link href="assets/css/bootstrap.min.css" rel="stylesheet">-->
    <!--<script src="assets/js/bootstrap.min.js"></script>-->



    <!--  Bootstrap CDN版-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


    <!-- Fonts -->

    <!-- Open Sans for body and title font -->



</head>
<body>





<!-- Start main content -->



        <div class="row table-view">





                <div class='pic' ><img id="shoeImage" ></div>
                <div class='subTitle' id="subTitle"></div>
                <div class='mainTitle' id="mainTitle"></div>
                <div class='smallTitle' id="smallTitle1"></div>
                <div class='smallTitle' id="smallTitle2"></div>
            <div class='smallTitle' id="smallTitle3"></div>


            <div id="attributeTable" style="margin-bottom: 100px"></div>

            <div class='smallTitle' id="skuTitle" >实时库存情况（数量为预估值）</div>
            <div id="skuTable" ></div>


            <div id="cardTable" ></div>

            <div class='emptyDiv' ></div>
        </div>



    <div class="floatButton" id="floatButton" >
        <img src="assets/images/luanch-nikeapp.png">
    </div>

    <div class="topBar" >
        <div class="topBarButton-Large" id="monitor-button" >库存监控</div>
        <div class="topBarLine" ></div>
        <div class="topBarButton-Small" id="reset-button" >✕</div>

    </div>






<!-- End main content -->




<!-- jQuery library -->
<script src="https://libs.baidu.com/jquery/2.0.3/jquery.min.js"></script>
<!-- tool library -->
<script src="assets/js/tool.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- we ui -->
<link rel="stylesheet" href="https://res.wx.qq.com/open/libs/weui/2.0.1/weui.min.css">
<script type="text/javascript" src="https://res.wx.qq.com/open/libs/weuijs/1.2.1/weui.min.js"></script>
<!--https://github.com/Tencent/weui.js/blob/master/docs/component/loading.md-->

<script type="text/javascript">

    jQuery(document).ready(function($){

        var loading;
        let baseApi = "https://api.nike.com/product_feed/threads/v2/?anchor=0&count=50"
        var stylecode = "";
        stylecode = UrlParm.parm("style");
        var channelId = "d9a5bc42-4b9c-4976-858a-f159cf99c647";
        let _channel = UrlParm.parm("channel");
        if( _channel && _channel == 'SNKRS'){
            channelId = "010794e5-35fe-4e32-aaff-cd2c74f89d61"
        }
        if(!stylecode || stylecode == 'null'){
            // stylecode = 'CK6637-104'

            weui.alert('进入参数错误！');
            return
        }else{
            reloadNike();
        }



        <!--==========================网络请求============================-->

        function reloadNike() {
            var currentApi = baseApi;
            currentApi = currentApi+"&filter=marketplace(CN)"
            currentApi = currentApi+"&filter=language(zh-Hans)"
            currentApi = currentApi+"&filter=channelId("+channelId+")"
            currentApi = currentApi+"&filter=exclusiveAccess(true,false)&filter=productInfo.merchProduct.styleColor("+stylecode+")"
            loading =  weui.loading('加载中');
            $.ajax({
                type : "get", //提交方式
                url : currentApi,//路径
                crossDomain: true,//跨域
                timeout:5000,
                dataType:'json',
                headers: {
                    'accept': '*/*',
                    'accept-language': 'zh-CN',
                    'Content-Type': 'application/json',
                },
                contentType: "application/json",
                data : {

                },//数据，这里使用的是Json格式进行传输
                success : function(data) {//返回数据根据结果进行相应的处理
                    loading.hide()
                    if(data.objects.length<1){
                        weui.alert('查询不到数据');
                        return;
                    }
                    var shoe_item = data.objects[0]
                    console.log(shoe_item)
                   try {

                        var defaultImage = "https://secure-images.nike.com/is/image/DotCom/"+stylecode.replace("-","_")
                       $("#shoeImage").attr("src",defaultImage)
                       $("#shoeImage").attr("src",shoe_item.productInfo[0].imageUrls.productImageUrl)
                   }catch (e) {}
                    try {
                        $("#subTitle").html(shoe_item.productInfo[0].productContent.subtitle)
                    }catch (e) { }
                    try {
                        $("#mainTitle").html(shoe_item.productInfo[0].productContent.title)
                    }catch (e) { }


                    try {
                        var startSelldata = new Date();
                        var startSellTime = shoe_item.productInfo[0].merchProduct.commerceStartDate
                        if (isNaN(startSellTime) && !isNaN(Date.parse(startSellTime))) {
                            startSelldata = new Date(startSellTime);
                            startSellTime = shoe_item.productInfo[0].merchProduct.commerceStartDate.substring(0, 19) + '(+8为北京时间)'
                            var BJ_Hour = parseInt(startSellTime.substring(11, 13)) + 8
                            var BJ_Day = parseInt(startSellTime.substring(8, 10))
                            if (BJ_Hour > 24) {
                                BJ_Day = BJ_Day + 1
                                BJ_Hour = BJ_Hour - 24
                            }
                            var BJ_Hour_Str = '' + BJ_Hour;
                            if (BJ_Hour < 10) {
                                BJ_Hour_Str = '0' + BJ_Hour_Str
                            }
                            startSellTime = "准许发售时间:"+startSellTime.substring(0, 8) + BJ_Day + " " + BJ_Hour_Str + startSellTime.substring(13, 19)
                        } else {
                            startSellTime = '未知时间'
                        }
                        $("#smallTitle1").html(startSellTime)
                    }catch (e) {

                    }
                    try {
                        var startSelldata = new Date();
                        var startSellTime = shoe_item.productInfo[0].launchView.startEntryDate
                        if (isNaN(startSellTime) && !isNaN(Date.parse(startSellTime))) {
                            startSelldata = new Date(startSellTime);
                            startSellTime = shoe_item.productInfo[0].launchView.startEntryDate.substring(0, 19) + '(+8为北京时间)'
                            var BJ_Hour = parseInt(startSellTime.substring(11, 13)) + 8
                            var BJ_Day = parseInt(startSellTime.substring(8, 10))
                            if (BJ_Hour > 24) {
                                BJ_Day = BJ_Day + 1
                                BJ_Hour = BJ_Hour - 24
                            }
                            var BJ_Hour_Str = '' + BJ_Hour;
                            if (BJ_Hour < 10) {
                                BJ_Hour_Str = '0' + BJ_Hour_Str
                            }
                            startSellTime = "抽签时间:"+startSellTime.substring(0, 8) + BJ_Day + " " + BJ_Hour_Str + startSellTime.substring(13, 19)
                        } else {
                            startSellTime = '未知时间'
                        }
                        $("#smallTitle2").html(startSellTime)
                    }catch (e) {

                    }


                    try {
                        var htmlString = '<div class=" table-row col-xs-12" >\n' +
                            '                <p class="row-key" >\n' +
                            '                    货号\n' +
                            '                </p>\n' +
                            '                <p class="row-value" >\n' +
                            stylecode +
                            '                </p>\n' +
                            '            </div>'
                        $("#attributeTable").html($("#attributeTable").html()+htmlString)
                    }catch (e) { }

                    try {
                        var selectionEngine = "FLOW"
                        selectionEngine = shoe_item.productInfo[0].launchView.method
                        var htmlString = '<div class=" table-row col-xs-12" >\n' +
                            '                <p class="row-key" >\n' +
                            '                    发售方式\n' +
                            '                </p>\n' +
                            '                <p class="row-value" >\n' +
                            selectionEngine +
                            '                </p>\n' +
                            '            </div>'
                        $("#attributeTable").html($("#attributeTable").html()+htmlString)
                    }catch (e) {
                        console.log(e)
                    }

                    try {
                        var htmlString = '<div class=" table-row col-xs-12" >\n' +
                            '                <p class="row-key" >\n' +
                            '                    在售状态\n' +
                            '                </p>\n' +
                            '                <p class="row-value" >\n' +
                            shoe_item.productInfo[0].merchProduct.status +
                            '                </p>\n' +
                            '            </div>'
                        $("#attributeTable").html($("#attributeTable").html()+htmlString)
                    }catch (e) { }


                    try {
                        var restricted = shoe_item.productInfo[0].merchProduct.exclusiveAccess
                        var restrictedStr = '未知'
                        if (restricted) {
                            restrictedStr = '专属购买'
                            var htmlString = '<div class=" table-row col-xs-12" >\n' +
                                '                <p class="row-key" >\n' +
                                '                    特殊发售\n' +
                                '                </p>\n' +
                                '                <p class="row-value" >\n' +
                                restrictedStr +
                                '                </p>\n' +
                                '            </div>'
                            $("#attributeTable").html($("#attributeTable").html()+htmlString)
                        }
                    }catch (e) { }

                    try {
                        var skusArray = shoe_item.productInfo[0].skus;
                        var availableSkusArray = shoe_item.productInfo[0].availableSkus;
                        for (var k = 0; k < availableSkusArray.length; k++) {
                            let tempAvailableSkus = availableSkusArray[k]

                            if (tempAvailableSkus.available == true) {
                                var localizedSize = "";
                                var nikeSize = "";
                                var level = tempAvailableSkus.level;
                                var levelStr = level;
                                let sizeId = tempAvailableSkus.id;
                                for (var mm = 0; mm < skusArray.length;mm++) {
                                    if(skusArray[mm].id==sizeId){
                                        try {
                                            nikeSize = skusArray[mm].nikeSize
                                            localizedSize = nikeSize
                                            localizedSize = skusArray[mm].countrySpecifications[0].localizedSize
                                        }catch (e){
                                        }
                                    }
                                }
                                if (level == "HIGH"){
                                    levelStr = "多 （大于500）"
                                } else if (level == "MEDIUM") {
                                    levelStr = "中 （约100～500）"
                                } else if (level == "LOW") {
                                    levelStr = "少 （小于99）"
                                } else if (level == "NA") {
                                    levelStr = "NA（即将发售无法查询）"
                                }

                                var htmlString = '<div class=" table-row col-xs-12" >\n' +
                                    '                <p class="row-key" >\n' +
                                    localizedSize +
                                    '                </p>\n' +
                                    '                <p class="row-value" >\n' +
                                    levelStr +
                                    '                </p>\n' +
                                    '            </div>'
                                $("#skuTable").html($("#skuTable").html()+htmlString)
                            }
                        }


                        $("#cardTable").html($("#cardTable").html()+'<div class="  col-xs-12"  style="width: 100%;padding: 10%;text-align: center;">信息更新于:'+shoe_item.lastFetchTime+'</div>')

                    }catch (e) {

                        console.log(e)
                    }






                },
                error: (err, type) => {

                },


            });
        }
        <!--==========================网络请求============================-->














        $("#reset-button").click(function(){
            history.back(-1)
        });
        $("#monitor-button").click(function(){
            weui.alert('功能快马加鞭开发中！敬请期待');
        });
        $("#floatButton").click(function(){
            if( _channel && _channel == 'SNKRS'){
                window.location.href = "SNKRS://product/"+stylecode;
            }else{
                window.location.href = "mynike://x-callback-url/product-details?style-color="+stylecode;
            }
        });
    })













</script>




</body>
</html>